# redis主从复制

> 主从复制是什么？
>
> 	1. 主机数据更新后根据配置和策略，自动同步到备机的master/slave机制。
> 	1. Master以写为主，Slave以读为主。



> 能干嘛？
>
> 	1. 读写分离，性能扩展。
> 	1. 容灾快速恢复。
>
> 
>
> ![](C:\Users\10757\Desktop\redis-learn\img\一主多从.png)



> 一主二仆
>
> ​	1. 主服务器挂掉了，从服务器不会上位，主服务器恢复后还是主服务器。



> 薪火相传
>
> ​	1. 从服务器之间级联





> 反客为主
>
>  	1. 主机down了，从机顶上；
> 	1. slaveof no one 开启



> 复制原理
>
> 	1. 从服务器启动后，发送sync命令到主服务器；
> 	1. Master收到命令后，先做持久化，RDB，然后发送给Slave；（全量复制）
> 	1. Slave收到后，将rdb加载到内存中；
> 	1. 之后，主服务器执行一次命令， 就发送一次；（增量复制）
>
> 
>
> 只要Slave重新连接Master，就要做一次全量复制；



> 哨兵模式
>
> - 反客为主的自动版：能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。
>
> 过程：
>
> 1. 创建sentinel.conf配置文件
>
> 哨兵模式下，主机down掉的情况，从从机中投票选举出新主机。
>
> 主机恢复后，只能作为从机。

![](C:\Users\10757\Desktop\redis-learn\img\哨兵模式选举机制.png)





> 缺点：
>
> ​	复制延时











