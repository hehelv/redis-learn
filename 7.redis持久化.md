# redis持久化

## RDB（redis database）

> 在指定的时间间隔内将内存中的数据集快照写入磁盘。（snapshot技术）
>
> 恢复时，将快照恢复到内存中。



> 备份是怎么进行的？
>
> 	1. Redis 会单独创建（fork）一个子进程来进行持久化，首先会将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何 IO 操作的，这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那 RDB 方式要比 AOF 方式更加的高效。
>
>
> RDB 的缺点是最后一次持久化后的数据可能丢失。





## AOF（Append Only File）

> 以日志的形势来记录每个写操作（增量保存）。
>
> 	1. 只记录读操作，不记录读操作。
> 	1. 只许追加文件，不可以改写文件。
> 	1. redis启动时，会读取该文件，重构数据。



> 重写压缩rewrite：
>
> 	1. 类似于一种空间优化。（去除掉一些无用的命令）
> 	1. 一般大小超过64M，会进行重写。
> 	1. 重写，也是fork一个子进程，然后用临时文件覆盖原AOF文件

























